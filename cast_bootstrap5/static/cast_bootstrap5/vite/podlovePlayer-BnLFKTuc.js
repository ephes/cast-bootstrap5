var I=Object.defineProperty;var D=(r,i,t)=>i in r?I(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var p=(r,i,t)=>D(r,typeof i!="symbol"?i+"":i,t);let s=null,y=0,u=null,h=null;const f="data-podlove-embed",b="data-podlove-embed-loaded",m="data-podlove-embed-failed",E="podlove-player-styles",P="color_scheme";function S(){return document.readyState==="complete"?Promise.resolve():(u||(u=new Promise(r=>{window.addEventListener("load",()=>r(),{once:!0})})),u)}function w(){return h||(h=new IntersectionObserver((r,i)=>{r.forEach(t=>{if(!t.isIntersecting)return;const e=t.target;e instanceof g&&e.initializePlayer(),i.unobserve(e)})})),h}function C(r){return typeof podlovePlayer=="function"?Promise.resolve():s||(s=new Promise((i,t)=>{const e=document.querySelector(`script[${f}]`);if(e){if(e.getAttribute(b)==="true"&&typeof podlovePlayer=="function"){i();return}if(e.getAttribute(m)==="true")e.remove();else{e.addEventListener("load",()=>i(),{once:!0}),e.addEventListener("error",()=>{e.setAttribute(m,"true"),e.remove(),s=null,t(new Error("Failed to load Podlove embed script"))},{once:!0});return}}const o=document.createElement("script");o.src=r,o.async=!0,o.setAttribute(f,"true"),o.addEventListener("load",()=>{o.setAttribute(b,"true"),i()},{once:!0}),o.addEventListener("error",()=>{o.setAttribute(m,"true"),o.remove(),s=null,t(new Error("Failed to load Podlove embed script"))},{once:!0}),document.head.appendChild(o)}),s)}function L(){const r=document.documentElement.getAttribute("data-bs-theme");return r==="light"||r==="dark"?r:null}function x(r){const i=L();if(!i)return r;const t=r.indexOf("#"),e=t===-1?r:r.slice(0,t),o=t===-1?"":r.slice(t+1),[a,l=""]=e.split("?"),d=new URLSearchParams(l);d.has(P)||d.set(P,i);const n=d.toString(),c=o?`#${o}`:"";return n?`${a}?${n}${c}`:`${a}${c}`}class g extends HTMLElement{constructor(){super();p(this,"observer");p(this,"isInitialized");p(this,"playerDiv");this.observer=null,this.isInitialized=!1,this.playerDiv=null}connectedCallback(){if(this.renderPlaceholder(),document.readyState==="complete"){this.observeElement();return}S().then(()=>this.observeElement())}disconnectedCallback(){this.observer&&this.observer.unobserve(this)}renderPlaceholder(){if(this.querySelector(".podlove-player-container"))return;if(!document.getElementById(E)){const e=document.createElement("style");e.id=E,e.textContent=`
        podlove-player .podlove-player-container {
          width: 100%;
          max-width: 936px;
          min-height: 300px;
          margin: 0 auto;
        }
        @media (max-width: 768px) {
          podlove-player .podlove-player-container {
            max-width: 366px;
            min-height: 500px;
          }
        }
        podlove-player .podlove-player-container iframe {
          width: 100%;
          height: 100%;
          border: none;
        }
      `,document.head.appendChild(e)}const t=document.createElement("div");t.classList.add("podlove-player-container"),this.appendChild(t)}observeElement(){this.observer=w(),this.observer.observe(this)}initializePlayer(){if(this.isInitialized)return;const t=this.querySelector(".podlove-player-container");if(!t)return;let e=this.getAttribute("id");e||(e=`podlove-player-${Date.now()}`,this.setAttribute("id",e)),this.dataset.playerInstanceId||(y+=1,this.dataset.playerInstanceId=String(y));const o=`${e}-player-${this.dataset.playerInstanceId}`,a=this.getAttribute("data-url");if(!a)return;this.isInitialized=!0;let l=this.getAttribute("data-config")||"/api/audios/player_config/";l=x(l);const d=this.getAttribute("data-template");let n=this.getAttribute("data-embed")||"https://cdn.podlove.org/web-player/5.x/embed.js";const{hostname:c,port:A}=window.location,v=this.getOrCreatePlayerDiv(t,o,d);typeof podlovePlayer=="function"?podlovePlayer(v,a,l):(c==="localhost"&&n.startsWith("/")&&(n=`http://localhost:${A}${n}`),C(n).then(()=>{if(typeof podlovePlayer=="function"){podlovePlayer(v,a,l);return}throw new Error("Podlove embed script did not register.")}).catch(()=>{this.isInitialized=!1}))}getOrCreatePlayerDiv(t,e,o){return this.playerDiv||(this.playerDiv=document.createElement("div"),this.playerDiv.classList.add("podlove-player-host")),t.contains(this.playerDiv)||t.appendChild(this.playerDiv),this.playerDiv.id=e,o!==null?this.playerDiv.setAttribute("data-template",o):this.playerDiv.removeAttribute("data-template"),this.playerDiv}}customElements.define("podlove-player",g);
