var A=Object.defineProperty;var I=(c,d,e)=>d in c?A(c,d,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[d]=e;var l=(c,d,e)=>I(c,typeof d!="symbol"?d+"":d,e);class g extends HTMLElement{constructor(){super();l(this,"currentImage");l(this,"currentModal");l(this,"boundThumbnailClick");l(this,"boundFooterClick");l(this,"boundKeydown");l(this,"pendingModalImage");l(this,"pendingFinalize");l(this,"loadingSequence");this.currentImage=null,this.currentModal=null,this.boundThumbnailClick=this.handleThumbnailClick.bind(this),this.boundFooterClick=this.handleFooterClick.bind(this),this.boundKeydown=this.handleKeydown.bind(this),this.pendingModalImage=null,this.pendingFinalize=null,this.loadingSequence=0}static register(e){"customElements"in window&&customElements.define(e||"image-gallery-bs5",g)}replaceImage(e){if(this.currentImage){const t=this.currentImage.getAttribute(e);if(t==="false")return;const r=this.querySelector("#"+t);r&&this.setModalImage(r)}}resolveModal(e){if(e){const t=e.getAttribute("data-bs-target");if(t){const r=document.querySelector(t);if(r)return r}}return this.querySelector(".modal")}showModal(e){if(!e)return;const t=window.bootstrap,r=t==null?void 0:t.Modal;if(r){r.getOrCreateInstance(e).show();return}e.classList.add("show"),e.style.display="block",e.removeAttribute("aria-hidden"),e.setAttribute("aria-modal","true"),document.body.classList.add("modal-open")}getModalBody(e){return e?e.querySelector(".modal-body"):null}getModalImage(e){return e?e.querySelector(".modal-body img"):null}isModalImageReady(e){return e.complete&&e.naturalWidth>0}ensureLoadingIndicator(e){let t=e.querySelector(".cast-gallery-loading-indicator");if(!t){t=document.createElement("div"),t.className="cast-gallery-loading-indicator",t.style.position="absolute",t.style.inset="0",t.style.display="none",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="1",t.style.pointerEvents="none";const r=document.createElement("div");r.className="spinner-border text-secondary",r.setAttribute("role","status"),r.setAttribute("aria-label","Loading image"),t.appendChild(r),e.appendChild(t)}return t}setLoadingState(e,t){const r=this.getModalBody(e);if(!r)return;r.style.position="relative";const n=this.ensureLoadingIndicator(r);n.style.display=t?"flex":"none",r.setAttribute("aria-busy",t?"true":"false");const a=this.getModalImage(e);a&&(a.style.transition="opacity 120ms ease",a.style.opacity=t?"0":"1")}applyAspectRatioFromThumbnail(e,t){var a,i;const r=Number((a=e.getAttribute("data-modal-width"))!=null?a:""),n=Number((i=e.getAttribute("data-modal-height"))!=null?i:"");if(r>0&&n>0){t.style.aspectRatio=`${r} / ${n}`;return}t.style.removeProperty("aspect-ratio")}ensureModalMediaSizing(e){const t=e.parentElement;t&&(t.style.display="block",t.style.width="100%");const r=t==null?void 0:t.parentElement;r&&r.tagName.toLowerCase()==="a"&&(r.style.display="block",r.style.width="100%")}syncImageLoadingState(e,t){if(this.clearPendingImageListeners(),this.setLoadingState(e,!0),this.isModalImageReady(t)){this.setLoadingState(e,!1);return}const r=++this.loadingSequence,n=()=>{this.currentModal===e&&this.loadingSequence===r&&this.setLoadingState(e,!1),this.pendingFinalize===n&&this.clearPendingImageListeners()};this.pendingModalImage=t,this.pendingFinalize=n,t.addEventListener("load",n,{once:!0}),t.addEventListener("error",n,{once:!0})}clearPendingImageListeners(){this.pendingModalImage&&this.pendingFinalize&&(this.pendingModalImage.removeEventListener("load",this.pendingFinalize),this.pendingModalImage.removeEventListener("error",this.pendingFinalize)),this.pendingModalImage=null,this.pendingFinalize=null}showModalImmediately(e){e&&this.showModal(e)}bindModalEvents(e){const t=e.querySelector(".modal-footer");t&&(t.removeEventListener("click",this.boundFooterClick),t.addEventListener("click",this.boundFooterClick)),e.removeEventListener("keydown",this.boundKeydown),e.addEventListener("keydown",this.boundKeydown)}unbindModalEvents(e){const t=e.querySelector(".modal-footer");t&&t.removeEventListener("click",this.boundFooterClick),e.removeEventListener("keydown",this.boundKeydown)}ensureModalInBody(e){e.parentElement!==document.body&&document.body.appendChild(e),this.id&&!e.hasAttribute("data-gallery-owner")&&e.setAttribute("data-gallery-owner",this.id),this.bindModalEvents(e)}cleanupModal(){this.clearPendingImageListeners();const e=this.id,t=e?`.modal[data-gallery-owner="${e}"]`:null,r=t?document.querySelector(t):this.currentModal;r&&r.parentElement===document.body&&(this.unbindModalEvents(r),r.remove()),this.currentModal=null}setModalImage(e,t){var f,v,M;if(this.currentImage=e,!e.parentNode){console.error("No parent node for image: ",e);return}const r=e.parentNode;if(!r.parentNode){console.error("No parent node for thumbnail picture: ",r);return}const n=(f=r.parentNode.getAttribute("data-full"))!=null?f:"",a=r.querySelector("source");if(!a){console.error("No thumbnail source for picture: ",r);return}const i=(v=t!=null?t:this.currentModal)!=null?v:this.resolveModal();if(!i){console.error("No modal for image gallery: ",this);return}this.ensureModalInBody(i),this.currentModal=i;const u=i.querySelector(".modal-body");if(!u){console.error("No modal body for modal: ",this);return}const p=i.querySelector(".modal-footer");if(!p){console.error("No modal footer for modal: ",this);return}const L=[{attr:"data-modal-srcset",prop:"srcset"},{attr:"data-modal-src",prop:"src"},{attr:"type",prop:"type"},{attr:"data-modal-sizes",prop:"sizes"}],y=u.querySelector("source");if(!y){console.error("No modal source for modal body: ",u);return}for(const{attr:b,prop:m}of L){const h=a.getAttribute(b);h&&y.setAttribute(m,h)}const w=[{attr:"alt",prop:"alt"},{attr:"data-prev",prop:"data-prev"},{attr:"data-next",prop:"data-next"},{attr:"data-modal-src",prop:"src"},{attr:"data-modal-srcset",prop:"srcset"},{attr:"data-modal-sizes",prop:"sizes"},{attr:"data-modal-height",prop:"height"},{attr:"data-modal-width",prop:"width"}],o=u.querySelector("img");if(!o){console.error("No modal image for modal body: ",u);return}((M=o.parentNode)==null?void 0:M.parentNode).setAttribute("href",n);for(const{attr:b,prop:m}of w){const h=e.getAttribute(b);h&&o.setAttribute(m,h)}e.hasAttribute("data-modal-width")||o.removeAttribute("width"),e.hasAttribute("data-modal-height")||o.removeAttribute("height"),this.ensureModalMediaSizing(o),this.applyAspectRatioFromThumbnail(e,o),this.syncImageLoadingState(i,o);let s="";o.getAttribute("data-prev")!=="false"?s=s+'<button id="data-prev" type="button" class="btn btn-primary">Prev</button>':s=s+'<button id="data-prev" type="button" class="btn btn-primary disabled">Prev</button>',o.getAttribute("data-next")!=="false"?s=s+'<button id="data-next" type="button" class="btn btn-primary">Next</button>':s=s+'<button id="data-next" type="button" class="btn btn-primary disabled">Next</button>',p.innerHTML=s}handleThumbnailClick(e){e.preventDefault(),e.stopPropagation();const t=e.currentTarget,r=t.querySelector("img");if(r){const n=this.resolveModal(t);this.setModalImage(r,n),this.showModalImmediately(n)}else console.error("No img element found in clicked thumbnail")}handleFooterClick(e){const t=e.target;t.matches("#data-prev, #data-next")&&this.replaceImage(t.id)}handleKeydown(e){e.key==="ArrowLeft"&&this.replaceImage("data-prev"),e.key==="ArrowRight"&&this.replaceImage("data-next")}connectedCallback(){this.querySelectorAll(".cast-gallery-container > a").forEach(t=>{var r;t.hasAttribute("data-bs-toggle")&&(t.setAttribute("data-gallery-bs-toggle",(r=t.getAttribute("data-bs-toggle"))!=null?r:"modal"),t.removeAttribute("data-bs-toggle")),t.removeEventListener("click",this.boundThumbnailClick),t.addEventListener("click",this.boundThumbnailClick)})}disconnectedCallback(){this.querySelectorAll(".cast-gallery-container > a").forEach(t=>{t.removeEventListener("click",this.boundThumbnailClick)}),this.cleanupModal()}}g.register("image-gallery-bs5");
