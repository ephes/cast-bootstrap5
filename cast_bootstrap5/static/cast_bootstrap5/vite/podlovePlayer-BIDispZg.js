var I=Object.defineProperty;var D=(o,r,t)=>r in o?I(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t;var l=(o,r,t)=>D(o,typeof r!="symbol"?r+"":r,t);let n=null,v=0,d=null,c=null;const m="data-podlove-embed",y="data-podlove-embed-loaded",p="data-podlove-embed-failed",f="podlove-player-styles";function A(){return document.readyState==="complete"?Promise.resolve():(d||(d=new Promise(o=>{window.addEventListener("load",()=>o(),{once:!0})})),d)}function w(){return c||(c=new IntersectionObserver((o,r)=>{o.forEach(t=>{if(!t.isIntersecting)return;const e=t.target;e instanceof b&&e.initializePlayer(),r.unobserve(e)})})),c}function L(o){return typeof podlovePlayer=="function"?Promise.resolve():n||(n=new Promise((r,t)=>{const e=document.querySelector(`script[${m}]`);if(e){if(e.getAttribute(y)==="true"&&typeof podlovePlayer=="function"){r();return}if(e.getAttribute(p)==="true")e.remove();else{e.addEventListener("load",()=>r(),{once:!0}),e.addEventListener("error",()=>{e.setAttribute(p,"true"),e.remove(),n=null,t(new Error("Failed to load Podlove embed script"))},{once:!0});return}}const i=document.createElement("script");i.src=o,i.async=!0,i.setAttribute(m,"true"),i.addEventListener("load",()=>{i.setAttribute(y,"true"),r()},{once:!0}),i.addEventListener("error",()=>{i.setAttribute(p,"true"),i.remove(),n=null,t(new Error("Failed to load Podlove embed script"))},{once:!0}),document.head.appendChild(i)}),n)}class b extends HTMLElement{constructor(){super();l(this,"observer");l(this,"isInitialized");l(this,"playerDiv");this.observer=null,this.isInitialized=!1,this.playerDiv=null}connectedCallback(){if(this.renderPlaceholder(),document.readyState==="complete"){this.observeElement();return}A().then(()=>this.observeElement())}disconnectedCallback(){this.observer&&this.observer.unobserve(this)}renderPlaceholder(){if(this.querySelector(".podlove-player-container"))return;if(!document.getElementById(f)){const e=document.createElement("style");e.id=f,e.textContent=`
        podlove-player .podlove-player-container {
          width: 100%;
          max-width: 936px;
          min-height: 300px;
          margin: 0 auto;
        }
        @media (max-width: 768px) {
          podlove-player .podlove-player-container {
            max-width: 366px;
            min-height: 500px;
          }
        }
        podlove-player .podlove-player-container iframe {
          width: 100%;
          height: 100%;
          border: none;
        }
      `,document.head.appendChild(e)}const t=document.createElement("div");t.classList.add("podlove-player-container"),this.appendChild(t)}observeElement(){this.observer=w(),this.observer.observe(this)}initializePlayer(){if(this.isInitialized)return;const t=this.querySelector(".podlove-player-container");if(!t)return;let e=this.getAttribute("id");e||(e=`podlove-player-${Date.now()}`,this.setAttribute("id",e)),this.dataset.playerInstanceId||(v+=1,this.dataset.playerInstanceId=String(v));const i=`${e}-player-${this.dataset.playerInstanceId}`,s=this.getAttribute("data-url");if(!s)return;this.isInitialized=!0;const u=this.getAttribute("data-config")||"/api/audios/player_config/",E=this.getAttribute("data-template");let a=this.getAttribute("data-embed")||"https://cdn.podlove.org/web-player/5.x/embed.js";const{hostname:P,port:g}=window.location,h=this.getOrCreatePlayerDiv(t,i,E);typeof podlovePlayer=="function"?podlovePlayer(h,s,u):(P==="localhost"&&a.startsWith("/")&&(a=`http://localhost:${g}${a}`),L(a).then(()=>{if(typeof podlovePlayer=="function"){podlovePlayer(h,s,u);return}throw new Error("Podlove embed script did not register.")}).catch(()=>{this.isInitialized=!1}))}getOrCreatePlayerDiv(t,e,i){return this.playerDiv||(this.playerDiv=document.createElement("div"),this.playerDiv.classList.add("podlove-player-host")),t.contains(this.playerDiv)||t.appendChild(this.playerDiv),this.playerDiv.id=e,i!==null?this.playerDiv.setAttribute("data-template",i):this.playerDiv.removeAttribute("data-template"),this.playerDiv}}customElements.define("podlove-player",b);
