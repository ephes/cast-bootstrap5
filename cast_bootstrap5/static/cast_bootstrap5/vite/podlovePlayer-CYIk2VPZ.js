var w=Object.defineProperty;var C=(e,r,i)=>r in e?w(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i;var d=(e,r,i)=>C(e,typeof r!="symbol"?r+"":r,i);let l=null,E=0,h=null,p=null,v=null;const P="data-podlove-embed",g="data-podlove-embed-loaded",m="data-podlove-embed-failed",I="podlove-player-styles",A="color_scheme";function L(){return document.readyState==="complete"?Promise.resolve():(h||(h=new Promise(e=>{window.addEventListener("load",()=>e(),{once:!0})})),h)}function x(){return p||(p=new IntersectionObserver((e,r)=>{e.forEach(i=>{if(!i.isIntersecting)return;const t=i.target;t instanceof f&&t.initializePlayer(),r.unobserve(t)})})),p}function _(e){return typeof podlovePlayer=="function"?Promise.resolve():l||(l=new Promise((r,i)=>{const t=document.querySelector(`script[${P}]`);if(t){if(t.getAttribute(g)==="true"&&typeof podlovePlayer=="function"){r();return}if(t.getAttribute(m)==="true")t.remove();else{t.addEventListener("load",()=>r(),{once:!0}),t.addEventListener("error",()=>{t.setAttribute(m,"true"),t.remove(),l=null,i(new Error("Failed to load Podlove embed script"))},{once:!0});return}}const n=document.createElement("script");n.src=e,n.async=!0,n.setAttribute(P,"true"),n.addEventListener("load",()=>{n.setAttribute(g,"true"),r()},{once:!0}),n.addEventListener("error",()=>{n.setAttribute(m,"true"),n.remove(),l=null,i(new Error("Failed to load Podlove embed script"))},{once:!0}),document.head.appendChild(n)}),l)}function y(){const e=document.documentElement.getAttribute("data-bs-theme");return e==="light"||e==="dark"?e:null}function z(e){const r=y();if(!r)return e;const i=e.indexOf("#"),t=i===-1?e:e.slice(0,i),n=i===-1?"":e.slice(i+1),[a,c=""]=t.split("?"),o=new URLSearchParams(c);o.has(A)||o.set(A,r);const u=o.toString(),s=n?`#${n}`:"";return u?`${a}?${u}${s}`:`${a}${s}`}class f extends HTMLElement{constructor(){super();d(this,"observer");d(this,"isInitialized");d(this,"playerDiv");d(this,"initVersion");this.observer=null,this.isInitialized=!1,this.playerDiv=null,this.initVersion=0}reinitializePlayer(){!this.isInitialized||!this.isConnected||(this.playerDiv&&(this.playerDiv.remove(),this.playerDiv=null),this.isInitialized=!1,delete this.dataset.playerInstanceId,this.initializePlayer())}connectedCallback(){if(this.renderPlaceholder(),document.readyState==="complete"){this.observeElement();return}L().then(()=>this.observeElement())}disconnectedCallback(){this.observer&&this.observer.unobserve(this),this.initVersion+=1,this.isInitialized=!1}renderPlaceholder(){if(this.querySelector(".podlove-player-container"))return;if(!document.getElementById(I)){const t=document.createElement("style");t.id=I,t.textContent=`
        podlove-player .podlove-player-container {
          width: 100%;
          max-width: 936px;
          min-height: 300px;
          margin: 0 auto;
        }
        @media (max-width: 768px) {
          podlove-player .podlove-player-container {
            max-width: 366px;
            min-height: 500px;
          }
        }
        podlove-player .podlove-player-container iframe {
          width: 100%;
          height: 100%;
          border: none;
        }
      `,document.head.appendChild(t)}const i=document.createElement("div");i.classList.add("podlove-player-container"),this.appendChild(i)}observeElement(){this.observer=x(),this.observer.observe(this)}initializePlayer(){if(this.isInitialized||!this.isConnected)return;const i=this.querySelector(".podlove-player-container");if(!i)return;let t=this.getAttribute("id");t||(t=`podlove-player-${Date.now()}`,this.setAttribute("id",t)),this.dataset.playerInstanceId||(E+=1,this.dataset.playerInstanceId=String(E));const n=`${t}-player-${this.dataset.playerInstanceId}`,a=this.getAttribute("data-url");if(!a)return;this.isInitialized=!0,this.initVersion+=1;const c=this.initVersion;let o=this.getAttribute("data-config")||"/api/audios/player_config/";o=z(o);const u=this.getAttribute("data-template");let s=this.getAttribute("data-embed")||"https://cdn.podlove.org/web-player/5.x/embed.js";const{hostname:D,port:S}=window.location,b=this.getOrCreatePlayerDiv(i,n,u);typeof podlovePlayer=="function"?podlovePlayer(b,a,o):(D==="localhost"&&s.startsWith("/")&&(s=`http://localhost:${S}${s}`),_(s).then(()=>{if(!(c!==this.initVersion||!this.isConnected)){if(typeof podlovePlayer=="function"){podlovePlayer(b,a,o);return}throw new Error("Podlove embed script did not register.")}}).catch(()=>{c===this.initVersion&&(this.isInitialized=!1)}))}getOrCreatePlayerDiv(i,t,n){return this.playerDiv||(this.playerDiv=document.createElement("div"),this.playerDiv.classList.add("podlove-player-host")),i.contains(this.playerDiv)||i.appendChild(this.playerDiv),this.playerDiv.id=t,n!==null?this.playerDiv.setAttribute("data-template",n):this.playerDiv.removeAttribute("data-template"),this.playerDiv}}customElements.define("podlove-player",f);v=y();const $=new MutationObserver(()=>{const e=y();e!==v&&(v=e,document.querySelectorAll("podlove-player").forEach(r=>{r instanceof f&&r.reinitializePlayer()}))});$.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]});
