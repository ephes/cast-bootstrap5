var z=Object.defineProperty;var K=(o,r,e)=>r in o?z(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e;var u=(o,r,e)=>K(o,typeof r!="symbol"?r+"":r,e);let p=null,k=0,A=null,S=null,L=null;const P="data-podlove-embed",C="data-podlove-embed-loaded",_="data-podlove-embed-failed",H="podlove-player-styles",O="color_scheme",b="#1e293b",g="#ffffff",F=297,V=309,B=100,W=900,Y=2500,f="data-cast-iframe-masked",v="data-cast-mask-active",I="podlove-player-reveal-shield",U=80,X=180,$=120,G="#paging-area",j=".pagination a, .cast-pagination a",y="data-cast-paging-remask",J=1600,Q="data-cast-paging-mask-active",Z=50,ee=120,te=3600,re=120;function ie(){return document.readyState==="complete"?Promise.resolve():(A||(A=new Promise(o=>{window.addEventListener("load",()=>o(),{once:!0})})),A)}function oe(){return S||(S=new IntersectionObserver((o,r)=>{o.forEach(e=>{if(!e.isIntersecting)return;const t=e.target;t instanceof M&&t.initializePlayer(),r.unobserve(t)})})),S}function le(o){return typeof podlovePlayer=="function"?Promise.resolve():p||(p=new Promise((r,e)=>{const t=document.querySelector(`script[${P}]`);if(t){if(t.getAttribute(C)==="true"&&typeof podlovePlayer=="function"){r();return}if(t.getAttribute(_)==="true")t.remove();else{t.addEventListener("load",()=>r(),{once:!0}),t.addEventListener("error",()=>{t.setAttribute(_,"true"),t.remove(),p=null,e(new Error("Failed to load Podlove embed script"))},{once:!0});return}}const i=document.createElement("script");i.src=o,i.async=!0,i.setAttribute(P,"true"),i.addEventListener("load",()=>{i.setAttribute(C,"true"),r()},{once:!0}),i.addEventListener("error",()=>{i.setAttribute(_,"true"),i.remove(),p=null,e(new Error("Failed to load Podlove embed script"))},{once:!0}),document.head.appendChild(i)}),p)}function R(){var r,e;const o=document.documentElement.getAttribute("data-bs-theme")||document.documentElement.getAttribute("data-theme")||((r=document.body)==null?void 0:r.getAttribute("data-bs-theme"))||((e=document.body)==null?void 0:e.getAttribute("data-theme"));return o==="light"||o==="dark"?o:typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":null}function ae(o){const r=R();if(!r)return o;const e=o.indexOf("#"),t=e===-1?o:o.slice(0,e),i=e===-1?"":o.slice(e+1),n=t.indexOf("?"),a=n===-1?t:t.slice(0,n),s=n===-1?"":t.slice(n+1),m=new URLSearchParams(s);m.has(O)||m.set(O,r);const d=m.toString(),c=i?`#${i}`:"";return d?`${a}?${d}${c}`:`${a}${c}`}function ne(){return typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches?V:F}function se(o){if(!o)return null;const e=o.trim().toLowerCase().match(/^rgba?\(([^)]+)\)$/);if(!e)return null;const t=e[1].split(",").slice(0,3).map(i=>Number.parseFloat(i.trim()));return t.length!==3||t.some(i=>Number.isNaN(i))?null:[t[0],t[1],t[2]]}function x(o){const r=se(o);if(!r)return!1;const[e,t,i]=r;return Math.min(e,t,i)>=170&&Math.max(e,t,i)-Math.min(e,t,i)<=35}function w(o){const r=window.getComputedStyle(o).backgroundColor;return!!(x(r)||o instanceof HTMLElement&&x(o.style.backgroundColor||null))}function de(o){let r=null;try{r=o.contentDocument}catch(a){return!1}if(!r||!r.documentElement)return!1;if(w(r.documentElement)||r.body&&w(r.body))return!0;const e=r.body||r.documentElement,t=r.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);let i=t.currentNode,n=0;for(;i&&n<re;){if(i instanceof Element){n+=1;const a=window.getComputedStyle(i);if(a.display!=="none"&&a.visibility!=="hidden"&&Number.parseFloat(a.opacity||"1")>.01&&w(i))return!0}i=t.nextNode()}return!1}function ce(o,r){r.getAttribute(y)!=="true"&&(r.setAttribute(y,"true"),r.setAttribute(f,"true"),r.style.opacity="0",r.style.pointerEvents="none",r.style.backgroundColor="inherit",r.style.colorScheme="inherit",o.setAttribute(v,"true"),window.setTimeout(()=>{!r.isConnected||r.getAttribute(y)!=="true"||(r.removeAttribute(y),r.getAttribute(f)==="true"&&r.removeAttribute(f),r.style.removeProperty("opacity"),r.style.removeProperty("pointer-events"),r.style.removeProperty("background-color"),r.style.removeProperty("color-scheme"),o.querySelector(`iframe[${y}="true"]`)||o.removeAttribute(v))},J))}function ue(o){const r=o.target;if(!(r instanceof Element)||!r.closest(j))return;const e=document.querySelector(G);e&&e.querySelectorAll(".podlove-player-container").forEach(t=>{t instanceof HTMLElement&&t.querySelectorAll("iframe").forEach(i=>{i instanceof HTMLIFrameElement&&i.getAttribute(f)!=="true"&&ce(t,i)})})}class M extends HTMLElement{constructor(){super();u(this,"observer");u(this,"isInitialized");u(this,"playerDiv");u(this,"initVersion");u(this,"iframeObserver");u(this,"iframeRevealDelayTimeoutId");u(this,"iframeRevealTimeoutId");u(this,"iframeRevealShieldTimeoutId");this.observer=null,this.isInitialized=!1,this.playerDiv=null,this.initVersion=0,this.iframeObserver=null,this.iframeRevealDelayTimeoutId=null,this.iframeRevealTimeoutId=null,this.iframeRevealShieldTimeoutId=null}reinitializePlayer(){!this.isInitialized||!this.isConnected||(this.clearIframeMasking(),this.playerDiv&&(this.playerDiv.remove(),this.playerDiv=null),this.isInitialized=!1,delete this.dataset.playerInstanceId,this.initializePlayer())}connectedCallback(){if(this.renderPlaceholder(),document.readyState==="complete"){this.observeElement();return}ie().then(()=>this.observeElement())}disconnectedCallback(){this.observer&&this.observer.unobserve(this),this.clearIframeMasking(),this.initVersion+=1,this.isInitialized=!1}clearIframeMasking(){this.iframeObserver&&(this.iframeObserver.disconnect(),this.iframeObserver=null),this.iframeRevealDelayTimeoutId!==null&&(window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=null),this.iframeRevealTimeoutId!==null&&(window.clearTimeout(this.iframeRevealTimeoutId),this.iframeRevealTimeoutId=null),this.iframeRevealShieldTimeoutId!==null&&(window.clearTimeout(this.iframeRevealShieldTimeoutId),this.iframeRevealShieldTimeoutId=null),this.querySelectorAll(".podlove-player-container").forEach(e=>{e instanceof HTMLElement&&(e.removeAttribute(v),e.querySelectorAll(`.${I}`).forEach(t=>{t.remove()}))})}applyReservedHeight(e){const t=`${ne()}px`;e.style.minHeight=t,this.style.minHeight=t}getOrCreateRevealShield(e){const t=e.querySelector(`.${I}`);if(t instanceof HTMLDivElement)return t.style.backgroundColor=e.style.backgroundColor||window.getComputedStyle(e).backgroundColor,t.style.opacity="1",t;const i=document.createElement("div");return i.classList.add(I),i.style.backgroundColor=e.style.backgroundColor||window.getComputedStyle(e).backgroundColor,i.style.opacity="1",e.appendChild(i),i}scheduleRevealShieldRelease(e,t){this.iframeRevealShieldTimeoutId!==null&&(window.clearTimeout(this.iframeRevealShieldTimeoutId),this.iframeRevealShieldTimeoutId=null);const i=this.getOrCreateRevealShield(e),n=e.style.colorScheme==="dark"?X:U;this.iframeRevealShieldTimeoutId=window.setTimeout(()=>{this.initVersion===t&&(i.style.opacity="0",this.iframeRevealShieldTimeoutId=window.setTimeout(()=>{this.initVersion===t&&(i.remove(),this.releaseReservedHeight(e),this.iframeRevealShieldTimeoutId=null)},$))},n)}maskIframeUntilReady(e,t){if(!(e instanceof HTMLElement))return;this.clearIframeMasking(),e.setAttribute(v,"true");const i=e.style.colorScheme==="dark"?W:B,n=new WeakSet,a=new WeakMap;let s=null;const m=()=>{const l=document.querySelector(G);return(l==null?void 0:l.getAttribute(Q))==="true"},d=l=>l.getAttribute(y)==="true"?!0:m(),c=l=>{if(this.initVersion===t&&!(!(l instanceof HTMLIFrameElement)||!e.contains(l))){if(d(l)){this.iframeRevealDelayTimeoutId!==null&&window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=window.setTimeout(()=>c(l),Z);return}if(e.style.colorScheme==="dark"){let h=a.get(l);if(h===void 0&&(h=performance.now(),a.set(l,h)),de(l)&&performance.now()-h<te){this.iframeRevealDelayTimeoutId!==null&&window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=window.setTimeout(()=>c(l),ee);return}}l.style.opacity="1",l.style.pointerEvents="",l.style.removeProperty("transition"),l.style.removeProperty("background-color"),l.style.removeProperty("color-scheme"),l.removeAttribute(f),e.removeAttribute(v),this.scheduleRevealShieldRelease(e,t),this.iframeRevealTimeoutId!==null&&(window.clearTimeout(this.iframeRevealTimeoutId),this.iframeRevealTimeoutId=null),this.iframeRevealDelayTimeoutId!==null&&(window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=null)}},T=l=>{this.iframeRevealDelayTimeoutId!==null&&window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=window.setTimeout(()=>c(l),i)},E=l=>{n.has(l)||(n.add(l),s=l,this.getOrCreateRevealShield(e),l.setAttribute(f,"true"),l.style.opacity="0",l.style.pointerEvents="none",l.style.transition="opacity 160ms ease",l.style.backgroundColor="inherit",l.style.colorScheme="inherit",l.addEventListener("load",()=>{s===l&&T(l)},{once:!0}),this.iframeRevealTimeoutId!==null&&window.clearTimeout(this.iframeRevealTimeoutId),this.iframeRevealTimeoutId=window.setTimeout(()=>c(s),Y))},D=()=>{e.querySelectorAll("iframe").forEach(h=>{h instanceof HTMLIFrameElement&&E(h)})};D(),this.iframeObserver=new MutationObserver(()=>{D()}),this.iframeObserver.observe(e,{childList:!0,subtree:!0})}applyLoadingTheme(e){if(!(e instanceof HTMLElement))return;const t=R()==="dark"?"dark":"light";e.style.backgroundColor=t==="dark"?b:g,e.style.colorScheme=t}renderPlaceholder(){if(this.querySelector(".podlove-player-container"))return;if(!document.getElementById(H)){const t=document.createElement("style");t.id=H,t.textContent=`
        podlove-player .podlove-player-container {
          width: 100%;
          max-width: 936px;
          min-height: ${F}px;
          margin: 0 auto;
          position: relative;
          overflow: hidden;
          background-color: ${g};
        }
        @media (max-width: 768px) {
          podlove-player .podlove-player-container {
            max-width: 366px;
            min-height: ${V}px;
          }
        }
        podlove-player .podlove-player-container iframe {
          width: 100%;
          height: 100%;
          border: none;
          background-color: inherit;
          color-scheme: inherit;
        }
        podlove-player .podlove-player-host {
          position: relative;
          z-index: 1;
        }
        podlove-player .podlove-player-container .${I} {
          position: absolute;
          inset: 0;
          pointer-events: none;
          z-index: 2;
          opacity: 1;
          transition: opacity ${$}ms ease;
        }
        podlove-player .podlove-player-container[${v}="true"] iframe {
          opacity: 0 !important;
          pointer-events: none !important;
        }
        @media (prefers-color-scheme: dark) {
          podlove-player .podlove-player-container {
            background-color: ${b};
          }
          podlove-player .podlove-player-container iframe {
            background-color: ${b};
            color-scheme: dark;
          }
        }
        html[data-bs-theme="dark"] podlove-player .podlove-player-container,
        html[data-theme="dark"] podlove-player .podlove-player-container,
        body[data-bs-theme="dark"] podlove-player .podlove-player-container,
        body[data-theme="dark"] podlove-player .podlove-player-container {
          background-color: ${b};
        }
        html[data-bs-theme="dark"] podlove-player .podlove-player-container iframe,
        html[data-theme="dark"] podlove-player .podlove-player-container iframe,
        body[data-bs-theme="dark"] podlove-player .podlove-player-container iframe,
        body[data-theme="dark"] podlove-player .podlove-player-container iframe {
          background-color: ${b};
          color-scheme: dark;
        }
        html[data-bs-theme="light"] podlove-player .podlove-player-container,
        html[data-theme="light"] podlove-player .podlove-player-container,
        body[data-bs-theme="light"] podlove-player .podlove-player-container,
        body[data-theme="light"] podlove-player .podlove-player-container {
          background-color: ${g};
        }
        html[data-bs-theme="light"] podlove-player .podlove-player-container iframe,
        html[data-theme="light"] podlove-player .podlove-player-container iframe,
        body[data-bs-theme="light"] podlove-player .podlove-player-container iframe,
        body[data-theme="light"] podlove-player .podlove-player-container iframe {
          background-color: ${g};
          color-scheme: light;
        }
      `,document.head.appendChild(t)}const e=document.createElement("div");e.classList.add("podlove-player-container"),this.applyLoadingTheme(e),this.applyReservedHeight(e),this.appendChild(e)}observeElement(){this.observer=oe(),this.observer.observe(this)}initializePlayer(){if(this.isInitialized||!this.isConnected)return;const e=this.querySelector(".podlove-player-container");if(!e)return;e instanceof HTMLElement&&this.applyReservedHeight(e),this.applyLoadingTheme(e);let t=this.getAttribute("id");t||(t=`podlove-player-${Date.now()}`,this.setAttribute("id",t)),this.dataset.playerInstanceId||(k+=1,this.dataset.playerInstanceId=String(k));const i=`${t}-player-${this.dataset.playerInstanceId}`,n=this.getAttribute("data-url");if(!n)return;this.isInitialized=!0,this.initVersion+=1;const a=this.initVersion;let s=this.getAttribute("data-config")||"/api/audios/player_config/";s=ae(s);const m=this.getAttribute("data-template");let d=this.getAttribute("data-embed")||"https://cdn.podlove.org/web-player/5.x/embed.js";const{hostname:c,port:T}=window.location,E=this.getOrCreatePlayerDiv(e,i,m);typeof podlovePlayer=="function"?(this.maskIframeUntilReady(e,a),podlovePlayer(E,n,s),this.maskIframeUntilReady(e,a)):(c==="localhost"&&d.startsWith("/")&&(d=`http://localhost:${T}${d}`),le(d).then(()=>{if(!(a!==this.initVersion||!this.isConnected)){if(typeof podlovePlayer=="function"){this.maskIframeUntilReady(e,a),podlovePlayer(E,n,s),this.maskIframeUntilReady(e,a);return}throw new Error("Podlove embed script did not register.")}}).catch(()=>{a===this.initVersion&&(this.isInitialized=!1,this.clearReservedHeight(e))}))}getOrCreatePlayerDiv(e,t,i){return this.playerDiv||(this.playerDiv=document.createElement("div"),this.playerDiv.classList.add("podlove-player-host")),e.contains(this.playerDiv)||e.appendChild(this.playerDiv),this.playerDiv.id=t,i!==null?this.playerDiv.setAttribute("data-template",i):this.playerDiv.removeAttribute("data-template"),this.playerDiv}releaseReservedHeight(e){e instanceof HTMLElement&&(e.style.minHeight="auto"),this.style.minHeight="auto"}clearReservedHeight(e){e instanceof HTMLElement&&e.style.removeProperty("min-height"),this.style.removeProperty("min-height")}}customElements.define("podlove-player",M);L=R();const q=new MutationObserver(()=>{const o=R();o!==L&&(L=o,document.querySelectorAll("podlove-player").forEach(r=>{r instanceof M&&r.reinitializePlayer()}))});q.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme","data-theme"]});const N=()=>{document.body&&q.observe(document.body,{attributes:!0,attributeFilter:["data-bs-theme","data-theme"]})};document.body?N():window.addEventListener("DOMContentLoaded",N,{once:!0});typeof document!="undefined"&&document.addEventListener("htmx:beforeRequest",ue,!0);
