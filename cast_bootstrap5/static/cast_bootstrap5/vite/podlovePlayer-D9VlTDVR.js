var I=Object.defineProperty;var D=(r,i,t)=>i in r?I(r,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[i]=t;var c=(r,i,t)=>D(r,typeof i!="symbol"?i+"":i,t);let l=null,v=0,p=null,u=null;const y="data-podlove-embed",f="data-podlove-embed-loaded",h="data-podlove-embed-failed",b="podlove-player-styles",E="color_scheme";function S(){return document.readyState==="complete"?Promise.resolve():(p||(p=new Promise(r=>{window.addEventListener("load",()=>r(),{once:!0})})),p)}function w(){return u||(u=new IntersectionObserver((r,i)=>{r.forEach(t=>{if(!t.isIntersecting)return;const e=t.target;e instanceof g&&e.initializePlayer(),i.unobserve(e)})})),u}function C(r){return typeof podlovePlayer=="function"?Promise.resolve():l||(l=new Promise((i,t)=>{const e=document.querySelector(`script[${y}]`);if(e){if(e.getAttribute(f)==="true"&&typeof podlovePlayer=="function"){i();return}if(e.getAttribute(h)==="true")e.remove();else{e.addEventListener("load",()=>i(),{once:!0}),e.addEventListener("error",()=>{e.setAttribute(h,"true"),e.remove(),l=null,t(new Error("Failed to load Podlove embed script"))},{once:!0});return}}const o=document.createElement("script");o.src=r,o.async=!0,o.setAttribute(y,"true"),o.addEventListener("load",()=>{o.setAttribute(f,"true"),i()},{once:!0}),o.addEventListener("error",()=>{o.setAttribute(h,"true"),o.remove(),l=null,t(new Error("Failed to load Podlove embed script"))},{once:!0}),document.head.appendChild(o)}),l)}function L(){const r=document.documentElement.getAttribute("data-bs-theme");return r==="light"||r==="dark"?r:null}function _(r){const i=L();if(!i)return r;const[t,e=""]=r.split("#"),[o,s=""]=t.split("?"),n=new URLSearchParams(s);n.has(E)||n.set(E,i);const d=n.toString(),a=e?`#${e}`:"";return d?`${o}?${d}${a}`:`${o}${a}`}class g extends HTMLElement{constructor(){super();c(this,"observer");c(this,"isInitialized");c(this,"playerDiv");this.observer=null,this.isInitialized=!1,this.playerDiv=null}connectedCallback(){if(this.renderPlaceholder(),document.readyState==="complete"){this.observeElement();return}S().then(()=>this.observeElement())}disconnectedCallback(){this.observer&&this.observer.unobserve(this)}renderPlaceholder(){if(this.querySelector(".podlove-player-container"))return;if(!document.getElementById(b)){const e=document.createElement("style");e.id=b,e.textContent=`
        podlove-player .podlove-player-container {
          width: 100%;
          max-width: 936px;
          min-height: 300px;
          margin: 0 auto;
        }
        @media (max-width: 768px) {
          podlove-player .podlove-player-container {
            max-width: 366px;
            min-height: 500px;
          }
        }
        podlove-player .podlove-player-container iframe {
          width: 100%;
          height: 100%;
          border: none;
        }
      `,document.head.appendChild(e)}const t=document.createElement("div");t.classList.add("podlove-player-container"),this.appendChild(t)}observeElement(){this.observer=w(),this.observer.observe(this)}initializePlayer(){if(this.isInitialized)return;const t=this.querySelector(".podlove-player-container");if(!t)return;let e=this.getAttribute("id");e||(e=`podlove-player-${Date.now()}`,this.setAttribute("id",e)),this.dataset.playerInstanceId||(v+=1,this.dataset.playerInstanceId=String(v));const o=`${e}-player-${this.dataset.playerInstanceId}`,s=this.getAttribute("data-url");if(!s)return;this.isInitialized=!0;let n=this.getAttribute("data-config")||"/api/audios/player_config/";n=_(n);const d=this.getAttribute("data-template");let a=this.getAttribute("data-embed")||"https://cdn.podlove.org/web-player/5.x/embed.js";const{hostname:P,port:A}=window.location,m=this.getOrCreatePlayerDiv(t,o,d);typeof podlovePlayer=="function"?podlovePlayer(m,s,n):(P==="localhost"&&a.startsWith("/")&&(a=`http://localhost:${A}${a}`),C(a).then(()=>{if(typeof podlovePlayer=="function"){podlovePlayer(m,s,n);return}throw new Error("Podlove embed script did not register.")}).catch(()=>{this.isInitialized=!1}))}getOrCreatePlayerDiv(t,e,o){return this.playerDiv||(this.playerDiv=document.createElement("div"),this.playerDiv.classList.add("podlove-player-host")),t.contains(this.playerDiv)||t.appendChild(this.playerDiv),this.playerDiv.id=e,o!==null?this.playerDiv.setAttribute("data-template",o):this.playerDiv.removeAttribute("data-template"),this.playerDiv}}customElements.define("podlove-player",g);
