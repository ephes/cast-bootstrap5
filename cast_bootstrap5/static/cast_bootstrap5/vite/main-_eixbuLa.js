var L=Object.defineProperty;var I=(u,d,t)=>d in u?L(u,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[d]=t;var l=(u,d,t)=>I(u,typeof d!="symbol"?d+"":d,t);class p extends HTMLElement{constructor(){super();l(this,"currentImage");l(this,"currentModal");l(this,"boundThumbnailClick");l(this,"boundFooterClick");l(this,"boundKeydown");l(this,"pendingModalImage");l(this,"pendingFinalize");l(this,"loadingSequence");this.currentImage=null,this.currentModal=null,this.boundThumbnailClick=this.handleThumbnailClick.bind(this),this.boundFooterClick=this.handleFooterClick.bind(this),this.boundKeydown=this.handleKeydown.bind(this),this.pendingModalImage=null,this.pendingFinalize=null,this.loadingSequence=0}static register(t){"customElements"in window&&customElements.define(t||"image-gallery-bs5",p)}replaceImage(t){if(this.currentImage){const e=this.currentImage.getAttribute(t);if(e==="false")return;const r=this.querySelector("#"+e);r&&this.setModalImage(r)}}resolveModal(t){if(t){const e=t.getAttribute("data-bs-target");if(e){const r=document.querySelector(e);if(r)return r}}return this.querySelector(".modal")}showModal(t){if(!t)return;const e=window.bootstrap,r=e==null?void 0:e.Modal;if(r){r.getOrCreateInstance(t).show();return}t.classList.add("show"),t.style.display="block",t.removeAttribute("aria-hidden"),t.setAttribute("aria-modal","true"),document.body.classList.add("modal-open")}getModalBody(t){return t?t.querySelector(".modal-body"):null}getModalImage(t){return t?t.querySelector(".modal-body img"):null}isModalImageReady(t){return t.complete&&t.naturalWidth>0}ensureLoadingIndicator(t){let e=t.querySelector(".cast-gallery-loading-indicator");if(!e){e=document.createElement("div"),e.className="cast-gallery-loading-indicator",e.style.position="absolute",e.style.inset="0",e.style.display="none",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="1",e.style.pointerEvents="none";const r=document.createElement("div");r.className="spinner-border text-secondary",r.setAttribute("role","status"),r.setAttribute("aria-label","Loading image"),e.appendChild(r),t.appendChild(e)}return e}setLoadingState(t,e){const r=this.getModalBody(t);if(!r)return;r.style.position="relative";const a=this.ensureLoadingIndicator(r);a.style.display=e?"flex":"none",r.setAttribute("aria-busy",e?"true":"false");const o=this.getModalImage(t);o&&(o.style.transition="opacity 120ms ease",o.style.opacity=e?"0":"1")}applyAspectRatioFromThumbnail(t,e){var o,i;const r=Number((o=t.getAttribute("data-modal-width"))!=null?o:""),a=Number((i=t.getAttribute("data-modal-height"))!=null?i:"");if(r>0&&a>0){e.style.aspectRatio=`${r} / ${a}`;return}e.style.removeProperty("aspect-ratio")}ensureModalMediaSizing(t){const e=t.parentElement;e&&(e.style.display="block",e.style.width="100%");const r=e==null?void 0:e.parentElement;r&&r.tagName.toLowerCase()==="a"&&(r.style.display="block",r.style.width="100%")}syncImageLoadingState(t,e){if(this.clearPendingImageListeners(),this.setLoadingState(t,!0),this.isModalImageReady(e)){this.setLoadingState(t,!1);return}const r=++this.loadingSequence,a=()=>{this.currentModal===t&&this.loadingSequence===r&&this.setLoadingState(t,!1),this.pendingFinalize===a&&this.clearPendingImageListeners()};this.pendingModalImage=e,this.pendingFinalize=a,e.addEventListener("load",a,{once:!0}),e.addEventListener("error",a,{once:!0})}clearPendingImageListeners(){this.pendingModalImage&&this.pendingFinalize&&(this.pendingModalImage.removeEventListener("load",this.pendingFinalize),this.pendingModalImage.removeEventListener("error",this.pendingFinalize)),this.pendingModalImage=null,this.pendingFinalize=null}showModalImmediately(t){t&&this.showModal(t)}bindModalEvents(t){const e=t.querySelector(".modal-footer");e&&!e.hasAttribute("data-gallery-footer-bound")&&(e.addEventListener("click",this.boundFooterClick),e.setAttribute("data-gallery-footer-bound","true")),t.hasAttribute("data-gallery-keydown-bound")||(t.addEventListener("keydown",this.boundKeydown),t.setAttribute("data-gallery-keydown-bound","true"))}unbindModalEvents(t){const e=t.querySelector(".modal-footer");e&&e.hasAttribute("data-gallery-footer-bound")&&(e.removeEventListener("click",this.boundFooterClick),e.removeAttribute("data-gallery-footer-bound")),t.hasAttribute("data-gallery-keydown-bound")&&(t.removeEventListener("keydown",this.boundKeydown),t.removeAttribute("data-gallery-keydown-bound"))}ensureModalInBody(t){t.parentElement!==document.body&&document.body.appendChild(t),this.id&&!t.hasAttribute("data-gallery-owner")&&t.setAttribute("data-gallery-owner",this.id),this.bindModalEvents(t)}cleanupModal(){this.clearPendingImageListeners();const t=this.id,e=t?`.modal[data-gallery-owner="${t}"]`:null,r=e?document.querySelector(e):this.currentModal;r&&r.parentElement===document.body&&(this.unbindModalEvents(r),r.remove()),this.currentModal=null}setModalImage(t,e){var f,v,M;if(this.currentImage=t,!t.parentNode){console.error("No parent node for image: ",t);return}const r=t.parentNode;if(!r.parentNode){console.error("No parent node for thumbnail picture: ",r);return}const a=(f=r.parentNode.getAttribute("data-full"))!=null?f:"",o=r.querySelector("source");if(!o){console.error("No thumbnail source for picture: ",r);return}const i=(v=e!=null?e:this.currentModal)!=null?v:this.resolveModal();if(!i){console.error("No modal for image gallery: ",this);return}this.ensureModalInBody(i),this.currentModal=i;const c=i.querySelector(".modal-body");if(!c){console.error("No modal body for modal: ",this);return}const m=i.querySelector(".modal-footer");if(!m){console.error("No modal footer for modal: ",this);return}const A=[{attr:"data-modal-srcset",prop:"srcset"},{attr:"data-modal-src",prop:"src"},{attr:"type",prop:"type"},{attr:"data-modal-sizes",prop:"sizes"}],y=c.querySelector("source");if(!y){console.error("No modal source for modal body: ",c);return}for(const{attr:b,prop:g}of A){const h=o.getAttribute(b);h&&y.setAttribute(g,h)}const w=[{attr:"alt",prop:"alt"},{attr:"data-prev",prop:"data-prev"},{attr:"data-next",prop:"data-next"},{attr:"data-modal-src",prop:"src"},{attr:"data-modal-srcset",prop:"srcset"},{attr:"data-modal-sizes",prop:"sizes"},{attr:"data-modal-height",prop:"height"},{attr:"data-modal-width",prop:"width"}],n=c.querySelector("img");if(!n){console.error("No modal image for modal body: ",c);return}((M=n.parentNode)==null?void 0:M.parentNode).setAttribute("href",a);for(const{attr:b,prop:g}of w){const h=t.getAttribute(b);h&&n.setAttribute(g,h)}t.hasAttribute("data-modal-width")||n.removeAttribute("width"),t.hasAttribute("data-modal-height")||n.removeAttribute("height"),this.ensureModalMediaSizing(n),this.applyAspectRatioFromThumbnail(t,n),this.syncImageLoadingState(i,n);let s="";n.getAttribute("data-prev")!=="false"?s=s+'<button id="data-prev" type="button" class="btn btn-primary">Prev</button>':s=s+'<button id="data-prev" type="button" class="btn btn-primary disabled">Prev</button>',n.getAttribute("data-next")!=="false"?s=s+'<button id="data-next" type="button" class="btn btn-primary">Next</button>':s=s+'<button id="data-next" type="button" class="btn btn-primary disabled">Next</button>',m.innerHTML=s}handleThumbnailClick(t){t.preventDefault(),t.stopPropagation();const e=t.currentTarget,r=e.querySelector("img");if(r){const a=this.resolveModal(e);this.setModalImage(r,a),this.showModalImmediately(a)}else console.error("No img element found in clicked thumbnail")}handleFooterClick(t){const e=t.target;e.matches("#data-prev, #data-next")&&this.replaceImage(e.id)}handleKeydown(t){t.key==="ArrowLeft"&&this.replaceImage("data-prev"),t.key==="ArrowRight"&&this.replaceImage("data-next")}connectedCallback(){this.querySelectorAll(".cast-gallery-container > a").forEach(e=>{var r;e.hasAttribute("data-bs-toggle")&&(e.setAttribute("data-gallery-bs-toggle",(r=e.getAttribute("data-bs-toggle"))!=null?r:"modal"),e.removeAttribute("data-bs-toggle")),e.classList.contains("event-added")||(e.addEventListener("click",this.boundThumbnailClick),e.classList.add("event-added"))})}disconnectedCallback(){this.querySelectorAll(".cast-gallery-container > a").forEach(e=>{e.removeEventListener("click",this.boundThumbnailClick),e.classList.remove("event-added")}),this.cleanupModal()}}p.register("image-gallery-bs5");
