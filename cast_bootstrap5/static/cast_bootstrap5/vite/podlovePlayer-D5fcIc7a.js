var w=Object.defineProperty;var C=(t,r,e)=>r in t?w(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var d=(t,r,e)=>C(t,typeof r!="symbol"?r+"":r,e);let l=null,E=0,u=null,p=null,v=null;const g="data-podlove-embed",P="data-podlove-embed-loaded",m="data-podlove-embed-failed",I="podlove-player-styles",A="color_scheme";function L(){return document.readyState==="complete"?Promise.resolve():(u||(u=new Promise(t=>{window.addEventListener("load",()=>t(),{once:!0})})),u)}function x(){return p||(p=new IntersectionObserver((t,r)=>{t.forEach(e=>{if(!e.isIntersecting)return;const i=e.target;i instanceof f&&i.initializePlayer(),r.unobserve(i)})})),p}function _(t){return typeof podlovePlayer=="function"?Promise.resolve():l||(l=new Promise((r,e)=>{const i=document.querySelector(`script[${g}]`);if(i){if(i.getAttribute(P)==="true"&&typeof podlovePlayer=="function"){r();return}if(i.getAttribute(m)==="true")i.remove();else{i.addEventListener("load",()=>r(),{once:!0}),i.addEventListener("error",()=>{i.setAttribute(m,"true"),i.remove(),l=null,e(new Error("Failed to load Podlove embed script"))},{once:!0});return}}const n=document.createElement("script");n.src=t,n.async=!0,n.setAttribute(g,"true"),n.addEventListener("load",()=>{n.setAttribute(P,"true"),r()},{once:!0}),n.addEventListener("error",()=>{n.setAttribute(m,"true"),n.remove(),l=null,e(new Error("Failed to load Podlove embed script"))},{once:!0}),document.head.appendChild(n)}),l)}function y(){const t=document.documentElement.getAttribute("data-bs-theme");return t==="light"||t==="dark"?t:null}function z(t){const r=y();if(!r)return t;const e=t.indexOf("#"),i=e===-1?t:t.slice(0,e),n=e===-1?"":t.slice(e+1),[a,c=""]=i.split("?"),o=new URLSearchParams(c);o.has(A)||o.set(A,r);const h=o.toString(),s=n?`#${n}`:"";return h?`${a}?${h}${s}`:`${a}${s}`}class f extends HTMLElement{constructor(){super();d(this,"observer");d(this,"isInitialized");d(this,"playerDiv");d(this,"initVersion");this.observer=null,this.isInitialized=!1,this.playerDiv=null,this.initVersion=0}reinitializePlayer(){!this.isInitialized||!this.isConnected||(this.playerDiv&&(this.playerDiv.remove(),this.playerDiv=null),this.isInitialized=!1,delete this.dataset.playerInstanceId,this.initializePlayer())}connectedCallback(){if(this.renderPlaceholder(),document.readyState==="complete"){this.observeElement();return}L().then(()=>this.observeElement())}disconnectedCallback(){this.observer&&this.observer.unobserve(this),this.initVersion+=1,this.isInitialized=!1}renderPlaceholder(){if(this.querySelector(".podlove-player-container"))return;if(!document.getElementById(I)){const i=document.createElement("style");i.id=I,i.textContent=`
        podlove-player .podlove-player-container {
          width: 100%;
          max-width: 936px;
          min-height: 300px;
          margin: 0 auto;
        }
        @media (max-width: 768px) {
          podlove-player .podlove-player-container {
            max-width: 366px;
            min-height: 500px;
          }
        }
        podlove-player .podlove-player-container iframe {
          width: 100%;
          height: 100%;
          border: none;
        }
      `,document.head.appendChild(i)}const e=document.createElement("div");e.classList.add("podlove-player-container"),this.appendChild(e)}observeElement(){this.observer=x(),this.observer.observe(this)}initializePlayer(){if(this.isInitialized||!this.isConnected)return;const e=this.querySelector(".podlove-player-container");if(!e)return;let i=this.getAttribute("id");i||(i=`podlove-player-${Date.now()}`,this.setAttribute("id",i)),this.dataset.playerInstanceId||(E+=1,this.dataset.playerInstanceId=String(E));const n=`${i}-player-${this.dataset.playerInstanceId}`,a=this.getAttribute("data-url");if(!a)return;this.isInitialized=!0,this.initVersion+=1;const c=this.initVersion;let o=this.getAttribute("data-config")||"/api/audios/player_config/";o=z(o);const h=this.getAttribute("data-template");let s=this.getAttribute("data-embed")||"https://cdn.podlove.org/web-player/5.x/embed.js";const{hostname:D,port:S}=window.location,b=this.getOrCreatePlayerDiv(e,n,h);typeof podlovePlayer=="function"?(podlovePlayer(b,a,o),this.releaseReservedHeight(e)):(D==="localhost"&&s.startsWith("/")&&(s=`http://localhost:${S}${s}`),_(s).then(()=>{if(!(c!==this.initVersion||!this.isConnected)){if(typeof podlovePlayer=="function"){podlovePlayer(b,a,o),this.releaseReservedHeight(e);return}throw new Error("Podlove embed script did not register.")}}).catch(()=>{c===this.initVersion&&(this.isInitialized=!1)}))}getOrCreatePlayerDiv(e,i,n){return this.playerDiv||(this.playerDiv=document.createElement("div"),this.playerDiv.classList.add("podlove-player-host")),e.contains(this.playerDiv)||e.appendChild(this.playerDiv),this.playerDiv.id=i,n!==null?this.playerDiv.setAttribute("data-template",n):this.playerDiv.removeAttribute("data-template"),this.playerDiv}releaseReservedHeight(e){e instanceof HTMLElement&&(e.style.minHeight="auto"),this.style.minHeight="auto"}}customElements.define("podlove-player",f);v=y();const R=new MutationObserver(()=>{const t=y();t!==v&&(v=t,document.querySelectorAll("podlove-player").forEach(r=>{r instanceof f&&r.reinitializePlayer()}))});R.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme"]});
