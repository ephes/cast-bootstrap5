var G=Object.defineProperty;var V=(o,t,e)=>t in o?G(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var c=(o,t,e)=>V(o,typeof t!="symbol"?t+"":t,e);let h=null,S=0,A=null,T=null,_=null;const M="data-podlove-embed",D="data-podlove-embed-loaded",R="data-podlove-embed-failed",k="podlove-player-styles",L="color_scheme",b="#1e293b",g="#ffffff",C=297,O=309,q=100,F=900,N=2500,v="data-cast-iframe-masked",y="data-cast-mask-active",$="#paging-area",z=".pagination a, .cast-pagination a",p="data-cast-paging-remask",K=1600,B="data-cast-paging-mask-active",U=50;function Y(){return document.readyState==="complete"?Promise.resolve():(A||(A=new Promise(o=>{window.addEventListener("load",()=>o(),{once:!0})})),A)}function W(){return T||(T=new IntersectionObserver((o,t)=>{o.forEach(e=>{if(!e.isIntersecting)return;const r=e.target;r instanceof w&&r.initializePlayer(),t.unobserve(r)})})),T}function X(o){return typeof podlovePlayer=="function"?Promise.resolve():h||(h=new Promise((t,e)=>{const r=document.querySelector(`script[${M}]`);if(r){if(r.getAttribute(D)==="true"&&typeof podlovePlayer=="function"){t();return}if(r.getAttribute(R)==="true")r.remove();else{r.addEventListener("load",()=>t(),{once:!0}),r.addEventListener("error",()=>{r.setAttribute(R,"true"),r.remove(),h=null,e(new Error("Failed to load Podlove embed script"))},{once:!0});return}}const a=document.createElement("script");a.src=o,a.async=!0,a.setAttribute(M,"true"),a.addEventListener("load",()=>{a.setAttribute(D,"true"),t()},{once:!0}),a.addEventListener("error",()=>{a.setAttribute(R,"true"),a.remove(),h=null,e(new Error("Failed to load Podlove embed script"))},{once:!0}),document.head.appendChild(a)}),h)}function E(){var t,e;const o=document.documentElement.getAttribute("data-bs-theme")||document.documentElement.getAttribute("data-theme")||((t=document.body)==null?void 0:t.getAttribute("data-bs-theme"))||((e=document.body)==null?void 0:e.getAttribute("data-theme"));return o==="light"||o==="dark"?o:typeof window.matchMedia=="function"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":null}function j(o){const t=E();if(!t)return o;const e=o.indexOf("#"),r=e===-1?o:o.slice(0,e),a=e===-1?"":o.slice(e+1),n=r.indexOf("?"),l=n===-1?r:r.slice(0,n),d=n===-1?"":r.slice(n+1),u=new URLSearchParams(d);u.has(L)||u.set(L,t);const s=u.toString(),m=a?`#${a}`:"";return s?`${l}?${s}${m}`:`${l}${m}`}function J(){return typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches?O:C}function Q(o,t){t.getAttribute(p)!=="true"&&(t.setAttribute(p,"true"),t.setAttribute(v,"true"),t.style.opacity="0",t.style.pointerEvents="none",t.style.backgroundColor="inherit",t.style.colorScheme="inherit",o.setAttribute(y,"true"),window.setTimeout(()=>{!t.isConnected||t.getAttribute(p)!=="true"||(t.removeAttribute(p),t.getAttribute(v)==="true"&&t.removeAttribute(v),t.style.removeProperty("opacity"),t.style.removeProperty("pointer-events"),t.style.removeProperty("background-color"),t.style.removeProperty("color-scheme"),o.querySelector(`iframe[${p}="true"]`)||o.removeAttribute(y))},K))}function Z(o){const t=o.target;if(!(t instanceof Element)||!t.closest(z))return;const e=document.querySelector($);e&&e.querySelectorAll(".podlove-player-container").forEach(r=>{r instanceof HTMLElement&&r.querySelectorAll("iframe").forEach(a=>{a instanceof HTMLIFrameElement&&a.getAttribute(v)!=="true"&&Q(r,a)})})}class w extends HTMLElement{constructor(){super();c(this,"observer");c(this,"isInitialized");c(this,"playerDiv");c(this,"initVersion");c(this,"iframeObserver");c(this,"iframeRevealDelayTimeoutId");c(this,"iframeRevealTimeoutId");this.observer=null,this.isInitialized=!1,this.playerDiv=null,this.initVersion=0,this.iframeObserver=null,this.iframeRevealDelayTimeoutId=null,this.iframeRevealTimeoutId=null}reinitializePlayer(){!this.isInitialized||!this.isConnected||(this.clearIframeMasking(),this.playerDiv&&(this.playerDiv.remove(),this.playerDiv=null),this.isInitialized=!1,delete this.dataset.playerInstanceId,this.initializePlayer())}connectedCallback(){if(this.renderPlaceholder(),document.readyState==="complete"){this.observeElement();return}Y().then(()=>this.observeElement())}disconnectedCallback(){this.observer&&this.observer.unobserve(this),this.clearIframeMasking(),this.initVersion+=1,this.isInitialized=!1}clearIframeMasking(){this.iframeObserver&&(this.iframeObserver.disconnect(),this.iframeObserver=null),this.iframeRevealDelayTimeoutId!==null&&(window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=null),this.iframeRevealTimeoutId!==null&&(window.clearTimeout(this.iframeRevealTimeoutId),this.iframeRevealTimeoutId=null),this.querySelectorAll(".podlove-player-container").forEach(e=>{e instanceof HTMLElement&&e.removeAttribute(y)})}applyReservedHeight(e){const r=`${J()}px`;e.style.minHeight=r,this.style.minHeight=r}maskIframeUntilReady(e,r){if(!(e instanceof HTMLElement))return;this.clearIframeMasking(),e.setAttribute(y,"true");const a=e.style.colorScheme==="dark"?F:q,n=new WeakSet;let l=null;const d=()=>{const i=document.querySelector($);return(i==null?void 0:i.getAttribute(B))==="true"},u=i=>i.getAttribute(p)==="true"?!0:d(),s=i=>{if(this.initVersion===r&&!(!(i instanceof HTMLIFrameElement)||!e.contains(i))){if(u(i)){this.iframeRevealDelayTimeoutId!==null&&window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=window.setTimeout(()=>s(i),U);return}i.style.opacity="1",i.style.pointerEvents="",i.style.removeProperty("transition"),i.style.removeProperty("background-color"),i.style.removeProperty("color-scheme"),i.removeAttribute(v),e.removeAttribute(y),this.releaseReservedHeight(e),this.iframeRevealTimeoutId!==null&&(window.clearTimeout(this.iframeRevealTimeoutId),this.iframeRevealTimeoutId=null),this.iframeRevealDelayTimeoutId!==null&&(window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=null)}},m=i=>{this.iframeRevealDelayTimeoutId!==null&&window.clearTimeout(this.iframeRevealDelayTimeoutId),this.iframeRevealDelayTimeoutId=window.setTimeout(()=>s(i),a)},I=i=>{n.has(i)||(n.add(i),l=i,i.setAttribute(v,"true"),i.style.opacity="0",i.style.pointerEvents="none",i.style.transition="opacity 160ms ease",i.style.backgroundColor="inherit",i.style.colorScheme="inherit",i.addEventListener("load",()=>{l===i&&m(i)},{once:!0}),this.iframeRevealTimeoutId!==null&&window.clearTimeout(this.iframeRevealTimeoutId),this.iframeRevealTimeoutId=window.setTimeout(()=>s(l),N))},f=()=>{e.querySelectorAll("iframe").forEach(P=>{P instanceof HTMLIFrameElement&&I(P)})};f(),this.iframeObserver=new MutationObserver(()=>{f()}),this.iframeObserver.observe(e,{childList:!0,subtree:!0})}applyLoadingTheme(e){if(!(e instanceof HTMLElement))return;const r=E()==="dark"?"dark":"light";e.style.backgroundColor=r==="dark"?b:g,e.style.colorScheme=r}renderPlaceholder(){if(this.querySelector(".podlove-player-container"))return;if(!document.getElementById(k)){const r=document.createElement("style");r.id=k,r.textContent=`
        podlove-player .podlove-player-container {
          width: 100%;
          max-width: 936px;
          min-height: ${C}px;
          margin: 0 auto;
          background-color: ${g};
        }
        @media (max-width: 768px) {
          podlove-player .podlove-player-container {
            max-width: 366px;
            min-height: ${O}px;
          }
        }
        podlove-player .podlove-player-container iframe {
          width: 100%;
          height: 100%;
          border: none;
          background-color: inherit;
          color-scheme: inherit;
        }
        podlove-player .podlove-player-container[${y}="true"] iframe {
          opacity: 0 !important;
          pointer-events: none !important;
        }
        @media (prefers-color-scheme: dark) {
          podlove-player .podlove-player-container {
            background-color: ${b};
          }
          podlove-player .podlove-player-container iframe {
            background-color: ${b};
            color-scheme: dark;
          }
        }
        html[data-bs-theme="dark"] podlove-player .podlove-player-container,
        html[data-theme="dark"] podlove-player .podlove-player-container,
        body[data-bs-theme="dark"] podlove-player .podlove-player-container,
        body[data-theme="dark"] podlove-player .podlove-player-container {
          background-color: ${b};
        }
        html[data-bs-theme="dark"] podlove-player .podlove-player-container iframe,
        html[data-theme="dark"] podlove-player .podlove-player-container iframe,
        body[data-bs-theme="dark"] podlove-player .podlove-player-container iframe,
        body[data-theme="dark"] podlove-player .podlove-player-container iframe {
          background-color: ${b};
          color-scheme: dark;
        }
        html[data-bs-theme="light"] podlove-player .podlove-player-container,
        html[data-theme="light"] podlove-player .podlove-player-container,
        body[data-bs-theme="light"] podlove-player .podlove-player-container,
        body[data-theme="light"] podlove-player .podlove-player-container {
          background-color: ${g};
        }
        html[data-bs-theme="light"] podlove-player .podlove-player-container iframe,
        html[data-theme="light"] podlove-player .podlove-player-container iframe,
        body[data-bs-theme="light"] podlove-player .podlove-player-container iframe,
        body[data-theme="light"] podlove-player .podlove-player-container iframe {
          background-color: ${g};
          color-scheme: light;
        }
      `,document.head.appendChild(r)}const e=document.createElement("div");e.classList.add("podlove-player-container"),this.applyLoadingTheme(e),this.applyReservedHeight(e),this.appendChild(e)}observeElement(){this.observer=W(),this.observer.observe(this)}initializePlayer(){if(this.isInitialized||!this.isConnected)return;const e=this.querySelector(".podlove-player-container");if(!e)return;e instanceof HTMLElement&&this.applyReservedHeight(e),this.applyLoadingTheme(e);let r=this.getAttribute("id");r||(r=`podlove-player-${Date.now()}`,this.setAttribute("id",r)),this.dataset.playerInstanceId||(S+=1,this.dataset.playerInstanceId=String(S));const a=`${r}-player-${this.dataset.playerInstanceId}`,n=this.getAttribute("data-url");if(!n)return;this.isInitialized=!0,this.initVersion+=1;const l=this.initVersion;let d=this.getAttribute("data-config")||"/api/audios/player_config/";d=j(d);const u=this.getAttribute("data-template");let s=this.getAttribute("data-embed")||"https://cdn.podlove.org/web-player/5.x/embed.js";const{hostname:m,port:I}=window.location,f=this.getOrCreatePlayerDiv(e,a,u);typeof podlovePlayer=="function"?(this.maskIframeUntilReady(e,l),podlovePlayer(f,n,d),this.maskIframeUntilReady(e,l)):(m==="localhost"&&s.startsWith("/")&&(s=`http://localhost:${I}${s}`),X(s).then(()=>{if(!(l!==this.initVersion||!this.isConnected)){if(typeof podlovePlayer=="function"){this.maskIframeUntilReady(e,l),podlovePlayer(f,n,d),this.maskIframeUntilReady(e,l);return}throw new Error("Podlove embed script did not register.")}}).catch(()=>{l===this.initVersion&&(this.isInitialized=!1,this.clearReservedHeight(e))}))}getOrCreatePlayerDiv(e,r,a){return this.playerDiv||(this.playerDiv=document.createElement("div"),this.playerDiv.classList.add("podlove-player-host")),e.contains(this.playerDiv)||e.appendChild(this.playerDiv),this.playerDiv.id=r,a!==null?this.playerDiv.setAttribute("data-template",a):this.playerDiv.removeAttribute("data-template"),this.playerDiv}releaseReservedHeight(e){e instanceof HTMLElement&&(e.style.minHeight="auto"),this.style.minHeight="auto"}clearReservedHeight(e){e instanceof HTMLElement&&e.style.removeProperty("min-height"),this.style.removeProperty("min-height")}}customElements.define("podlove-player",w);_=E();const x=new MutationObserver(()=>{const o=E();o!==_&&(_=o,document.querySelectorAll("podlove-player").forEach(t=>{t instanceof w&&t.reinitializePlayer()}))});x.observe(document.documentElement,{attributes:!0,attributeFilter:["data-bs-theme","data-theme"]});const H=()=>{document.body&&x.observe(document.body,{attributes:!0,attributeFilter:["data-bs-theme","data-theme"]})};document.body?H():window.addEventListener("DOMContentLoaded",H,{once:!0});typeof document!="undefined"&&document.addEventListener("htmx:beforeRequest",Z,!0);
