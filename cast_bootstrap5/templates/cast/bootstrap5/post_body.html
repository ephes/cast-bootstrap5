{% load wagtailcore_tags %}
{% load i18n %}

<article class="{% if render_detail %}post-detail{% else %}post-card{% endif %}">
  <header>
    <h2 class="{% if render_detail %}post-title{% else %}post-card-title{% endif %}">
      <a href="{{ page.page_url }}"{% if not render_detail %} data-cast-prefetch{% endif %}>{{ page.title }}</a>
      {% if render_for_feed and comments_are_enabled %}
        {% translate "(click here to comment)" %}
      {% endif %}
    </h2>
    <!-- link is on one line to avoid underlined whitespace -->
    <div class="post-card-meta">
      <a href="{{ page.page_url }}"{% if not render_detail %} data-cast-prefetch{% endif %}><time datetime="{{ page.visible_date|date:"c" }}">{{ page.visible_date|date }}</time>,</a>
      <span class="author">{{ page.owner.username | title}}</span>
    </div>
  </header>
  <div class="{% if render_detail %}post-body{% else %}post-card-excerpt{% endif %}">
    {% for block in page.body %}
      {# this is either an overview or detail block #}
      {% if block.block_type != "detail" or render_detail %}
        <section class="block-{{ block.block_type }}">
          {% for block in block.value %}
            {# this is a block of content like image, gallery or audio #}
            <section class="block-{{ block.block_type }}">
              {% include_block block %}
            </section>
          {% endfor %}
        </section>
        {% if not render_detail %}
          {% block detail_link %}
            <div class="post-card-readmore">
              <a href="{{ page.page_url }}" data-cast-prefetch aria-label="{% translate "Read more about" %} {{ page.title }}">{% translate "Read more" %} â†’</a>
            </div>
          {% endblock %}
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>
  {% if render_detail and episode_transcript_url %}
    <footer class="mt-4">
      <a class="btn btn-outline-secondary btn-sm" href="{{ episode_transcript_url }}">
        {% translate "View transcript" %}
      </a>
    </footer>
  {% endif %}
</article>
