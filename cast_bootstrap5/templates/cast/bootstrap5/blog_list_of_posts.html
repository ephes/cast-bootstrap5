{% extends "./base.html" %}
{% load wagtailcore_tags %}
{% load crispy_forms_tags %}
{% load static %}
{% load django_vite %}
{% load i18n %}

{% block body_class %}template-bloglistpage{% endblock %}

{% block meta %}
  {{ block.super }}
  {% if blog.noindex %}
    <meta name="robots" content="noindex">
  {% endif %}
  <link rel="canonical" href="{{ canonical_url }}">
  {% if use_audio_player %}
    <link rel="preconnect" href="https://cdn.podlove.org" />
  {% endif %}
{% endblock %}

{% block content %}
  <div class="cast-reading">
    <div class="cast-post-list-header cast-post-list-header--hero">
      <div>
        <h1 class="blog-title">{{ page.title }}</h1>
        <div class="intro lead">{{ page.description|richtext }}</div>
      </div>

      {% block feeds %}
        <div class="cast-post-list-actions">
          <div class="cast-feeds-container">
            <div class="cast-feed-item">
              <a class="cast-feed-link" href="{% url "cast:latest_entries_feed" slug=blog.slug %}">
                <img
                  alt="RSS feed icon"
                  class="cast-feed-icon"
                  src="{% static 'cast/img/Feed-icon.svg' %}"
                  height="64"
                  width="64"
                >
                <span>Plain RSS</span>
              </a>
            </div>
            {% if blog.is_podcast %}
              <div class="cast-feed-item">
                <a class="cast-feed-link" href="{% url "cast:podcast_feed_rss" slug=podcast.slug audio_format='m4a' %}">
                  <span>Podcast RSS MP4</span>
                </a>
              </div>
              <div class="cast-feed-item">
                <a class="cast-feed-link" href="{% url "cast:podcast_feed_atom" slug=podcast.slug audio_format='m4a' %}">
                  <span>Podcast Atom MP4</span>
                </a>
              </div>
            {% endif %}
          </div>
        </div>
      {% endblock feeds %}
    </div>

    {% block filters %}
      {% include "./_active_filters.html" with page=page filterset=filterset active_facets=active_facets %}
    {% endblock filters %}

    <noscript>
      <div class="cast-noscript-search">
        <form action="{{ page.url }}" method="get">
          <label for="noscript-search">{% translate "Search posts" %}</label>
          <input type="text" id="noscript-search" name="search"
                 value="{{ request.GET.search|default:'' }}"
                 placeholder="{% translate 'Search posts...' %}">
          <button type="submit">{% translate "Search" %}</button>
        </form>
      </div>
    </noscript>

    <div id="paging-area">
      <div class="post-list">
        {% for post in posts %}
          {% include "./post_body.html" with render_detail=False page=post %}
        {% endfor %}
      </div>

      <footer>
        {% include "./pagination.html" %}
      </footer>
    </div>
  </div>

  {% include "./_search_modal.html" with page=page filterset=filterset %}
{% endblock content %}

{% block javascript %}
  {{ block.super }}
  {% vite_hmr_client app="cast-bootstrap5" %}
  {% vite_asset 'src/search/cast-search-modal.ts' app="cast-bootstrap5" %}
  {% vite_asset 'src/filters/filter-enhancements-bootstrap.ts' app="cast-bootstrap5" %}
  {% vite_asset 'src/content/post-content-enhancements.ts' app="cast-bootstrap5" %}
  {% vite_asset 'src/gallery/image-gallery-bs5.ts' app="cast-bootstrap5" %}
  {% if use_audio_player %}
    {% vite_asset 'src/audio/podlove-player.ts' app="cast-bootstrap5" %}
  {% endif %}
{% endblock javascript %}
